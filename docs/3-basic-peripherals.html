<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Periféricos básicos de la Raspberry Pi</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #2a211c;
    color: #bdae9d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
div.sourceCode
  { color: #bdae9d; background-color: #2a211c; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffff00; } /* Alert */
code span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #44aa43; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
code span.ch { color: #049b0a; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
code span.do { color: #0066ff; font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.dv { color: #44aa43; } /* DecVal */
code span.er { color: #ffff00; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #44aa43; } /* Float */
code span.fu { color: #ff9358; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
code span.op { } /* Operator */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.sc { color: #049b0a; } /* SpecialChar */
code span.ss { color: #049b0a; } /* SpecialString */
code span.st { color: #049b0a; } /* String */
code span.va { } /* Variable */
code span.vs { color: #049b0a; } /* VerbatimString */
code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Periféricos básicos de la Raspberry Pi</h1>
</header>
<h2 id="introducción">Introducción</h2>
<p>La tarjeta Raspberry Pi 3B+ dispone de un conector especial de 40 pines a una interfaz de <a href="https://www.raspberrypi.org/documentation/usage/gpio/">entrada–salida de propósito general</a> (GPIO, por sus siglas en inglés). Esta interfaz permite controlar <em>hardware</em> externo al procesador de la Raspberry Pi y que podemos usar en programas de aplicación. En la figura 1, podemos ver el diagrama del conector utilizado por la GPIO.</p>
<figure>
<img src="https://www.raspberrypi.org/documentation/usage/gpio/images/GPIO-Pinout-Diagram-2.png" alt="Figura 1: Diagrama del conector de la interfaz de GPIO [@RaspberryPiFoundation2020]" style="width:50.0%" /><figcaption><strong>Figura 1</strong>: Diagrama del conector de la interfaz de GPIO <span class="citation" data-cites="RaspberryPiFoundation2020">[@RaspberryPiFoundation2020]</span></figcaption>
</figure>
<p>Los pines de la interfaz de GPIO pueden cumplir una gran variedad de funciones <span class="citation" data-cites="RaspberryPiFoundation2020">[@RaspberryPiFoundation2020]</span>, como por ejemplo:</p>
<ul>
<li>Entrada</li>
<li>Salida</li>
<li><a href="https://es.wikipedia.org/wiki/Modulaci%C3%B3n_por_ancho_de_pulsos">Modulación de ancho de pulso</a> (PWM, por sus siglas en inglés) por <em>software</em>.</li>
</ul>
<p>Además, algunos pines tienen funciones especiales; tales como:</p>
<ul>
<li>PWM en <em>hardware</em>.</li>
<li><a href="https://es.wikipedia.org/wiki/Serial_Peripheral_Interface">Interfaz serie para periféricos</a> (SPI, por sus siglas en inglés) (SPI0 y SPI1).</li>
<li><a href="https://es.wikipedia.org/wiki/I%C2%B2C">Circuito inter-integrado</a> (I<sup>2</sup>C, por sus siglas en inglés).</li>
<li><a href="https://es.wikipedia.org/wiki/Puerto_serie">Puerto serie</a></li>
</ul>
<p>Existen varios programas y librerías para utilizar la GPIO de la Raspberry Pi; sin embargo, no todos son recomendados por el fabricante y otros se han vuelto obsoletos. Uno de los recomendados por el fabricante es <a href="https://kernel.googlesource.com/pub/scm/libs/libgpiod/libgpiod/+/refs/heads/master/README"><code>gpiod</code></a> <span class="citation" data-cites="Golaszewski2021">[@Golaszewski2021]</span>.</p>
<p>El sistema <code>gpiod</code> consiste en dos componentes. El primer componente es la librería <code>libgpiod</code>. La librería permite desarrollar programas en C y C++. Revisaremos la librería más adelante.</p>
<p>El segundo componente son un conjunto de programas que permiten acceder a la interfaz de GPIO, así como modificar o consultar valores de los pines, desde la línea de comando.</p>
<h2 id="material-equipo-y-software.">Material, equipo y <em>software</em>.</h2>
<h3 id="material">Material</h3>
<ul>
<li>Resistencia de 220 Ohm.</li>
<li>Led rojo.</li>
<li>Cables <em>jump</em> macho–macho.</li>
</ul>
<h3 id="equipo">Equipo</h3>
<ul>
<li>Raspberry Pi 3B+ con conexión a Internet.</li>
<li>Computadora PC con conexión a Internet.</li>
</ul>
<h3 id="software">Software</h3>
<ul>
<li>Raspbian OS en tarjeta microSSD.</li>
</ul>
<h2 id="actividad-comando-pinout">Actividad: Comando <code>pinout</code></h2>
<p>En la Raspberry Pi, podemos consultar la disposición de las terminales del conector de la interfaz GPIO, por medio del comando <code>pinout</code> <span class="citation" data-cites="RaspberryPiFoundation2020">[@RaspberryPiFoundation2020]</span>.</p>
<figure>
<img src="https://www.raspberrypi.org/documentation/usage/gpio/images/gpiozero-pinout.png" alt="Figura 3: Resultado de la ejecución del comando pinout [@RaspberryPiFoundation2020]" style="width:50.0%" /><figcaption><strong>Figura 3</strong>: Resultado de la ejecución del comando <code>pinout</code> <span class="citation" data-cites="RaspberryPiFoundation2020">[@RaspberryPiFoundation2020]</span></figcaption>
</figure>
<h2 id="actividad-instalar-gpiod">Actividad: Instalar <code>gpiod</code></h2>
<p>Para instalar los programas de <code>gpiod</code>, empezaremos por actualizar el sistema de paquetes del Raspeberry Pi OS y después realizar la instalación como tal, utilizando la línea de comando de la Raspberry. Podemos ver las instrucciones en el siguiente listado:</p>
<div class="sourceCode" id="cb1" name="raspberry-install-gpiod.sh" data-caption="raspberry-install-gpiod.sh" data-numbers="left" data-frame="leftline"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">sudo</span> apt update</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">sudo</span> apt -y install gpiod</a></code></pre></div>
<h2 id="actividad-visualizar-el-estado-de-la-gpio">Actividad: Visualizar el estado de la GPIO</h2>
<p>Ya que tenemos instalada la librería y los programas, podemos usar comandos para manipular la interfaz de GPIO. Por ejemplo, el comando <code>gpiodetect</code> muestra los diferentes interfaces de la GPIO:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">gpiodetect</span></a></code></pre></div>
<figure>
<img src="https://raw.githubusercontent.com/ghsalazar/dsp-images/main/images/raspberry-pi-gpiodetect.png" alt="Resultado del comando gpiodetect" style="width:50.0%" /><figcaption>Resultado del comando <code>gpiodetect</code></figcaption>
</figure>
<p>Podemos ver el resultado del comando en la figura, donde se muestran tres interfaces diferentes. La interfaz que nos interesa es <code>gpiochip0</code>. La siguiente operación será ver que líneas o pines tiene disponible la interfaz. Esto lo hacemos por medio de siguiente comando</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">gpioinfo</span> gpiochip0</a></code></pre></div>
<figure>
<img src="https://github.com/ghsalazar/dsp-images/raw/main/images/raspberry-pi-gpioinfo.png" alt="Resultado del comando gpioinfo" style="width:50.0%" /><figcaption>Resultado del comando <code>gpioinfo</code></figcaption>
</figure>
<h2 id="actividad-manipulando-la-gpio-desde-la-línea-de-comando">Actividad: Manipulando la GPIO desde la línea de comando</h2>
<figure>
<img src="https://github.com/ghsalazar/dsp-images/raw/main/images/raspberry-pi-gpio-led.png" alt="Figura. Ensamble el circuito de la figura." /><figcaption><strong>Figura</strong>. Ensamble el circuito de la figura.</figcaption>
</figure>
<p>Existen otros dos comandos importantes. El primero es <code>gpioset</code>. Este comando convierte una línea o pin en salida y le da un valor especificado. Por ejemplo,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">gpioset</span> gpiochip0 24=1</a></code></pre></div>
<p>le indica a la interfaz <code>gpiochip0</code> que convierta en salida a la línea 24 o <code>GPIO24</code> y le asigne un valor de 1. Por otro lado</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">gpioset</span> gpiochip0 24=0</a></code></pre></div>
<p>hace lo mismo, pero le asigna a GPIO24 el valor de 0. El comando gpioset tiene más capacidades y se recomienda leer su <a href="https://manpages.debian.org/experimental/gpiod/gpioset.1.en.html">manual</a>.</p>
<p>El otro comando es <code>gpioget</code>. Este comando convierte una línea o pin en entrada y lee el valor que tiene. Por ejemplo</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">gpioget</span> gpiochip0 24</a></code></pre></div>
<p>le indica a la interfaz <code>gpiochip0</code> que convierta en entrada a la línea 24 o <code>GPIO24</code> y lea el valor que tiene.</p>
<p>A continuación, se tiene un ejemplo completo, aprovechando el comando gpioinfo. También se utiliza el comando <a href="https://es.wikipedia.org/wiki/Grep">grep</a> para filtrar los resultados.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">gpioinfo</span> gpiochip0 <span class="kw">|</span> <span class="fu">grep</span> 24</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ex">gpioset</span> gpiochip0 24=0</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="ex">gpioinfo</span> gpiochip0 <span class="kw">|</span> <span class="fu">grep</span> 24</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="ex">gpioget</span> gpiochip0 24</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="ex">gpioinfo</span> gpiochip0 <span class="kw">|</span> <span class="fu">grep</span> 24</a></code></pre></div>
<figure>
<img src="https://github.com/ghsalazar/dsp-images/raw/main/images/raspberry-pi-gpioset-gpioget.png" alt="Resultados de ejecutar gpioset y gpioget sobre GPIO24." style="width:50.0%" /><figcaption>Resultados de ejecutar <code>gpioset</code> y <code>gpioget</code> sobre GPIO24.</figcaption>
</figure>
<h2 id="aplicaciones-con-libgpiod">Aplicaciones con <code>libgpiod</code></h2>
<p>El uso de programas en el espacio de usuario puede permitir acelerar el desarrollo de una aplicación; sin embargo, este tipo de programas pueden alentar un proceso. Por lo tanto, conviene normalmente utilizar un lenguaje compilado para asegurar un mejor desempeño.</p>
<p>Al instalar los programas en el espacio del usuario, se incluyó el paquete de la librería <code>libgpio</code>; pero para poder desarrollar un programa en C se necesita además los archivos de encabezado. Para ello instalaremos el paquete <code>libgpio-dev</code> por medio de las siguientes instrucciones</p>
<div class="sourceCode" id="cb8" name="raspberry-install-gpiod.sh" data-caption="raspberry-install-gpiod.sh" data-numbers="left" data-frame="leftline"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">sudo</span> apt install libgpiod-dev</a></code></pre></div>
<p>Una vez instalada la librería es posible desarrollar un programa en C, como el del ejemplo del siguiente listado.</p>
<h2 id="el-programa-blink">El programa <code>blink</code></h2>
<script src="http://gist-it.appspot.com/https://github.com/ghsalazar/dsp-raspberrypi/raw/main/examples/blink.c"></script>
<p>El código anterior puede parecer muy complicado para empezar a programar la GPIO de la Raspberry Pi. Para ello partiremos el código en su diferentes secciones. La primera sección consiste en simplemente un comentario.</p>
<div class="sourceCode" id="cb9" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb9-1" title="1"><span class="co">/** Es un pequeño ejemplo de las funcionalidades del interfaz del GPIO  */</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">/** de la Raspberry Pi por medio de la librería libgpiod.               */</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">/**                                                                     */</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">/** Para compilar el programa, se debe utilizar el comando:             */</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">/**     gcc blink.c -lgpiod -o blink                                    */</span></a></code></pre></div>
<p>Lo más importante del comentario es la última línea, que indica como se debe compilar el ejemplo desde la línea de comando del Raspberry Pi OS. El compilador de C utilizado es el <a href="https://iie.fing.edu.uy/~vagonbar/gcc-make/gcc.htm"><code>gcc</code></a>. Este compilador es el más utilizado en el entorno de programación GNU/Linux. Este compilador tiene un conjunto muy amplio de opciones.</p>
<p>En el comentario se manejan dos opciones. La primera opción (<code>-lgpiod</code>) indica que el programa se debe enlazar a la librería <code>libgpiod</code>. La segunda opción (<code>-o blink</code>) explicita cual nombre tendrá el programa final.</p>
<p>A continuación, se tiene la inclusión de dos archivos de encabezado.</p>
<div class="sourceCode" id="cb10" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb10-1" title="1"><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="pp">#include </span><span class="im">&lt;gpiod.h&gt;</span></a></code></pre></div>
<p>Cuando incluimos archivos de encabezado, se anexan declaraciones de funciones. En el archivo <a href="https://en.wikipedia.org/wiki/Unistd.h"><code>unistd.h</code></a>, tenemos la declaración de la función <a href="https://man7.org/linux/man-pages/man3/usleep.3.html">usleep(3)</a>, que suspende la ejecución del programa por un intervalo medido en microsegundos (us).</p>
<div class="sourceCode" id="cb11" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb11-1" title="1"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb11-2" title="2">{</a></code></pre></div>
<div class="sourceCode" id="cb12" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb12-1" title="1">    <span class="kw">struct</span> gpiod_chip *chip;</a>
<a class="sourceLine" id="cb12-2" title="2">    chip = gpiod_chip_open_by_name(<span class="st">&quot;gpiochip0&quot;</span>);</a></code></pre></div>
<div class="sourceCode" id="cb13" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb13-1" title="1">    <span class="kw">struct</span> gpiod_line *led;</a>
<a class="sourceLine" id="cb13-2" title="2">    led = gpiod_chip_get_line(chip, <span class="dv">24</span>);</a>
<a class="sourceLine" id="cb13-3" title="3">    gpiod_line_request_output(led, <span class="st">&quot;myLED&quot;</span>, <span class="dv">0</span>);</a></code></pre></div>
<div class="sourceCode" id="cb14" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb14-1" title="1">    <span class="kw">struct</span> gpiod_line *button;</a>
<a class="sourceLine" id="cb14-2" title="2">    button = gpiod_chip_get_line(chip, <span class="dv">6</span>);</a>
<a class="sourceLine" id="cb14-3" title="3">    gpiod_line_request_input(button, <span class="st">&quot;button&quot;</span>);</a></code></pre></div>
<div class="sourceCode" id="cb15" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb15-1" title="1">    <span class="dt">int</span> state = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb15-2" title="2">    <span class="dt">int</span> input = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="cf">while</span> (input == <span class="dv">1</span>) {</a></code></pre></div>
<div class="sourceCode" id="cb16" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb16-1" title="1">        state = state ^ <span class="dv">1</span>;</a></code></pre></div>
<div class="sourceCode" id="cb17" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb17-1" title="1">        gpiod_line_set_value(led, state);</a>
<a class="sourceLine" id="cb17-2" title="2">        input = gpiod_line_get_value(button);</a></code></pre></div>
<div class="sourceCode" id="cb18" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb18-1" title="1">        usleep(<span class="dv">500000</span>);</a>
<a class="sourceLine" id="cb18-2" title="2">    }</a></code></pre></div>
<div class="sourceCode" id="cb19" name="blink.c" data-caption="blink.c" data-numbers="left" data-frame="leftline"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb19-1" title="1">    gpiod_line_set_value(led, <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb19-2" title="2">    gpiod_line_release(led);</a>
<a class="sourceLine" id="cb19-3" title="3">    gpiod_line_release(button);</a>
<a class="sourceLine" id="cb19-4" title="4">    </a>
<a class="sourceLine" id="cb19-5" title="5">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb19-6" title="6">}</a></code></pre></div>
<h2 id="actividad-implementar-el-programa-blink">Actividad: Implementar el programa <code>blink</code></h2>
<h2 id="referencias">Referencias</h2>
</body>
</html>
